{% extends "spareapp/contBase.html" %}

{% block title %} Day {% endblock %}

{% block content %}

{% load static %}

{% include "spareapp/accountStatSuperior.html" %}

<div class="container mt-2 col-lg-4">
<form action="" method="POST">
    {% csrf_token %}
    <div class="mb-3">
        <label class="form-label" for="contNombre">Cliente</label>
        <select name="contNombre" id="contNombre" class="form-select form-select-md" aria-label=".form-select-md example" required>
            <option value="" selected>Seleccionar cliente</option>
            {% for cust in allCustomers %}
            <option value="{{cust.id}}">{{cust.nombre}} - {{cust.documento}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <input value="all" class="form-check-input" id="search1" type="radio" name="search" checked>
        <label class="form-check-label" for="search1">Todos</label>
        <input value="month" class="form-check-input" id="search2" type="radio" name="search">
        <label class="form-check-label" for="search2">Éste mes</label>
        <input value="range" class="form-check-input" id="search4" type="radio" name="search">
        <label class="form-check-label" for="search4">Rango</label>
        <input value="balance" class="form-check-input" id="search5" type="radio" name="search">
        <label class="form-check-label" for="search5">Último balance</label>
    </div>
    <div class="mb-3" id="formByRange" style="display: none;">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-6">
                    <label for="searchDateFrom">Desde</label>
                    <input name="searchDateFrom" id="searchDateFrom" class="form-control" type="date">
                </div>
                <div class="col-lg-6">
                    <label for="searchDateTo">Hasta</label>
                    <input name="searchDateTo" id="searchDateTo" class="form-control" type="date">
                </div>
            </div>
        </div>
    </div>
    <button class="btn btn-primary" type="submit">Aceptar</button>
    <a href="{% url 'contDay' %}" class="btn btn-danger">Cancelar</a>
</form>

</div>
{% if factureName %}
<div class="container mt-2">
<a href="#" id="downloadexcel" class="btn btn-success">Excel</a>
<a href="#" onClick="generatePDF()" class="btn btn-success">PDF</a>
</div>
<div class="container mt-2">
<label for=""><span style="font-weight: bold;color: rgb(136,12,12);">Cliente: </span>{{factureName.0.refPersona.nombre}}</label>
<div>
    <a data-bs-toggle="modal" data-bs-target="#editName" type="button" id="editNameId" class="btn btn-primary text-white" href="javascript:void(0);">
        Editar cliente
    </a>
    <div tabindex="-1" id="editName" class="modal fade modal-dialog-scrollable" aria-labelledby="editNameLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editNameLabel">Editar cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"> 
                    <form id="formCust" method="POST" action="{% url 'contEditPerson' factureName.0.refPersona.id %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label" for="custName">Nombre</label>
                            <input value="{{factureName.0.refPersona.nombre}}" class="form-control" id="custName" type="text" name="custName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" for="custId">Identificación</label>
                            <input value="{{factureName.0.refPersona.documento}}" class="form-control" id="custId" type="text" name="custId">
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </form>
                    
                </div>   
            </div>
        </div>
    </div>  
</div>
<table id="invoice" style="font-size: small;" class="table-bordered invoice draggable table-sortable mt-2 mb-4">
    <thead>
        <tr style="background-color: #F5F087" class="">
            <th colspan="10" class="p-2">{{factureName.0.refPersona.nombre|upper}}</th>
        </tr>
        <tr style="background-color: #7C8FEC;" class="">
            <th class="p-2">Fact #</th>
            <th class="p-2">Fecha</th>
            <th class="p-2">Cliente</th>
            <th class="p-2">Tipo de pago</th>
            <th class="p-2">Categoría</th>
            <!-- <th class="p-2">Debito</th>
            <th class="p-2">Credito</th> -->
            <th class="p-2">Balance</th>
            <th class="p-2">Nota</th>
            <th id="check" class="p-2">Acción</th>
        </tr>
    </thead>
    <tbody id="myTable">
        {% for fact in factureName %}
        {% for key,value in balance.items %}
        {% if key == fact.id %}
        <tr>
            <td class="p-2">{{fact.num}}</td>
            <td class="p-2">{{fact.fechaCreado|date:"M d, Y"}}</td>
            <td class="p-2">{{fact.refPersona.nombre}}</td>
            <td style="max-width: 50px;" class="p-2"><a href="{% url 'contListByType' fact.refType.nombre %}">{{fact.refType.nombre|upper}}</a></td>
            <td style="max-width: 50px;" class="p-2"><a href="{% url 'contListByCategory' fact.refCategory.nombre %}">{{fact.refCategory.nombre|upper}}</a></td>

            <!-- {% if fact.pendiente == True or fact.refType.nombre == "FACTURA POR COBRAR" or fact.refType.nombre == "MERCANCIA CREDITO POR PAGAR" %}
            <td class="p-2">$0.00</td>
            {% else %}
            <td class="p-2">${{fact.total|floatformat:2}}</td>
            {% endif %}

            {% if fact.pendiente == True or fact.refType.nombre == "FACTURA POR COBRAR" or fact.refType.nombre == "MERCANCIA CREDITO POR PAGAR" %}
            <td class="p-2">${{fact.total|floatformat:2}}</td>
            {% else %}
            <td class="p-2">$0.00</td>
            {% endif %} -->

            <td class="p-2">${{value|floatformat:2}}</td>
            <td style="max-width: 200px;" class="p-2">{{fact.note}}</td>
            <td class=""><a style="color: white;font-size: small;" class="btn btn-secondary" href="{% url 'editeFact' fact.id request.get_full_path|cut:'/' %}">Editar</a>
                <a data-bs-toggle="modal" data-bs-target="#deleteFac{{fact.id}}" style="text-decoration: none;color: rgb(136,12,12);font-size: small;" id="deleteFacId" class="btn btn-danger text-white" href="javascript:void(0);">Eliminar</a>
            </td>
            <div tabindex="-1" id="deleteFac{{fact.id}}" class="modal fade modal-dialog-scrollable" aria-labelledby="deleteFacLabel{{fact.id}}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="deleteFacLabel{{fact.id}}">Precaución</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            ¿Seguro/a que deseas eliminar la factura {{fact.num}}?
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <a id="deleteFacture" class="btn btn-primary" href="{% url 'deleteFac' fact.id %}">Borrar</a>
                        </div>
                    </div>
                    </div>
            </div> 
        </tr>
        {% endif %}
        {% endfor %}
        {% endfor %}
        <tr style="background-color: #E77C7C;" class="">
            <td class="p-2" colspan="10">BALANCE ${{balanceTotal|floatformat:2}}</td>
        </tr>
    </tbody>
</table>
</div>

<script type="text/javascript" src="{% static 'spareapp/dragtable.js' %}"></script>
<script>
$("#invoice").dragtable()

</script>
{% endif %}

{% endblock %}