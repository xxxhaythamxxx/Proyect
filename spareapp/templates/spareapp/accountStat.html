{% extends "spareapp/contBase.html" %}

{% block title %} Day {% endblock %}

{% block content %}

{% load static %}

<div class="container mt-5 col-lg-4">
<form action="" method="POST">
    {% csrf_token %}
    <div class="mb-3">
        <label class="form-label" for="contNombre">Cliente</label>
        <select name="contNombre" id="contNombre" class="form-select form-select-md" aria-label=".form-select-md example" required>
            <option value="" selected>Seleccionar cliente</option>
            {% for cust in allCustomers %}
            <option value="{{cust.id}}">{{cust.nombre}} - {{cust.documento}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <input value="all" class="form-check-input" id="search1" type="radio" name="search" checked>
        <label class="form-check-label" for="search1">Todos</label>
        <input value="month" class="form-check-input" id="search2" type="radio" name="search">
        <label class="form-check-label" for="search2">Éste mes</label>
        <input value="range" class="form-check-input" id="search4" type="radio" name="search">
        <label class="form-check-label" for="search4">Rango</label>
        <input value="balance" class="form-check-input" id="search5" type="radio" name="search">
        <label class="form-check-label" for="search5">Último balance</label>
    </div>
    <div class="mb-3" id="formByRange" style="display: none;">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-6">
                    <label for="searchDateFrom">Desde</label>
                    <input name="searchDateFrom" id="searchDateFrom" class="form-control" type="date">
                </div>
                <div class="col-lg-6">
                    <label for="searchDateTo">Hasta</label>
                    <input name="searchDateTo" id="searchDateTo" class="form-control" type="date">
                </div>
            </div>
        </div>
    </div>
    <button class="btn btn-primary" type="submit">Aceptar</button>
    <a href="{% url 'contDay' %}" class="btn btn-danger">Cancelar</a>
</form>

</div>
{% if factureName %}
<div class="container mt-2">
<a href="#" id="downloadexcel" class="btn btn-success">Excel</a>
<a href="#" onClick="generatePDF()" class="btn btn-success">PDF</a>
</div>
<div class="container mt-2">
<label for=""><span style="font-weight: bold;color: rgb(136,12,12);">Cliente: </span>{{factureName.0.refPersona.nombre}}</label>
<div>
    <a data-bs-toggle="modal" data-bs-target="#editName" style="text-decoration: none;color: rgb(136,12,12);" id="editNameId" class="btn btn-primary text-white" href="javascript:void(0);">
        Editar cliente
    </a>
    <div tabindex="-1" id="editName" class="modal fade modal-dialog-scrollable" aria-labelledby="editNameLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editNameLabel">Editar cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"> 
                    <form id="formCust" method="POST" action="{% url 'contEditPerson' factureName.0.refPersona.id %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label" for="custName">Nombre</label>
                            <input value="{{factureName.0.refPersona.nombre}}" class="form-control" id="custName" type="text" name="custName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" for="custId">Identificación</label>
                            <input value="{{factureName.0.refPersona.documento}}" class="form-control" id="custId" type="text" name="custId">
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </form>
                    
                </div>   
            </div>
        </div>
    </div>  
</div>
<table id="invoice" style="font-size: small;" class="table-bordered invoice draggable table-sortable mt-2 mb-2">
    <thead>
        <tr class="color text-white">
            <th class="p-2">Fact #</th>
            <th class="p-2">Fecha</th>
            <th class="p-2">Cliente</th>
            <th class="p-2">Tipo de pago</th>
            <th class="p-2">Nota</th>
            <th class="p-2">Categoría</th>
            <th class="p-2">Debito</th>
            <th class="p-2">Credito</th>
            <th class="p-2">Balance</th>
            <th class="p-2">Acción</th>
        </tr>
    </thead>
    <tbody id="myTable">
        {% for fact in factureName %}
        {% for key,value in balance.items %}
        {% if key == fact.id %}
        <tr>
            <td class="p-2">{{fact.num}}</td>
            <td class="p-2">{{fact.fechaCreado|date:"M d, Y"}}</td>
            <td class="p-2">{{fact.refPersona.nombre}}</td>
            <td class="p-2"><a href="{% url 'contListByType' fact.refType.nombre %}">{{fact.refType.nombre}}</a></td>
            <td style="max-width: 200px;" class="p-2">{{fact.note}}</td>
            <td class="p-2"><a href="{% url 'contListByCategory' fact.refCategory.nombre %}">{{fact.refCategory.nombre}}</a></td>

            {% if fact.pendiente == True or fact.refType.nombre == "FACTURA POR COBRAR" or fact.refType.nombre == "MERCANCIA CREDITO POR PAGAR" %}
            <td class="p-2">$0.00</td>
            {% else %}
            <td class="p-2">${{fact.total|floatformat:2}}</td>
            {% endif %}

            {% if fact.pendiente == True or fact.refType.nombre == "FACTURA POR COBRAR" or fact.refType.nombre == "MERCANCIA CREDITO POR PAGAR" %}
            <td class="p-2">${{fact.total|floatformat:2}}</td>
            {% else %}
            <td class="p-2">$0.00</td>
            {% endif %}

            <td class="p-2">${{value|floatformat:2}}</td>
            <td class="p-2"><a style="color: white;font-size: small;" class="btn btn-secondary mx-1" href="{% url 'editeFact' fact.id request.get_full_path|cut:'/' %}">Editar</a>
        </tr>
        {% endif %}
        {% endfor %}
        {% endfor %}
    </tbody>
</table>
</div>
<div class="container mb-5 table-bordered">
<table>
    <tr>
        <td style="width: 80px;" class="p-2 color text-white">Total</td>
        <td class="p-2">$ {{balanceTotal|floatformat:2}}</td>
    </tr>
</table>
</div>

<script type="text/javascript" src="{% static 'spareapp/dragtable.js' %}"></script>
<script>
$("#invoice").dragtable()

// // Editar customer
// $("#formCust").submit(function(e){
//     e.preventDefault()

//     cat = $("#custName").val()
//     doc = $("#custId").val()

//     $.ajax({
//         url: $(this).attr("action"),
//         type: $(this).attr("method"),
//         data: $(this).serialize(),
        
//         success: function(data){
//             console.log("Success")
//             // $("#contNombre").append("<option value="+data.lastPerson[0].id+" selected>"+cat+" - "+doc+"</option>")
//             $(".btn-close").click()
//         }
//     })
// })
</script>
{% endif %}

{% endblock %}