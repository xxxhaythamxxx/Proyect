{% extends "spareapp/base.html" %}

{% block title %} Auto Repuestos Interamericana {% endblock %}

{% block content %}

<input id="requestVentas" value="{{request.user.profile.ventas}}" type="text" hidden>
<input id="superuser" value="{{request.user.is_superuser}}" type="text" hidden>
<input id="requestBodega" value="{{request.user.profile.bodega}}" type="text" hidden>
<input id="requestMayorista" value="{{request.user.profile.mayorista}}" type="text" hidden>
<input id="autenticado" value="{{request.user.is_authenticated}}" type="text" hidden>
<input id="mig" value="{{mig}}" type="text" hidden>

{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
            <div class="notification alert alert-primary">
                {{message}}
            </div>
        {% endif %}
    {% endfor %}
{% endif %}

<div class="resultadoBusqueda">
{% if mig %}
<div class="migajas color-soft color-hard p-2">{{parameter}}: {{mig}} </div>
{% endif %}

    {% include "spareapp/superior.html" %}

<form class="" method="POST" action="">
    {% include "spareapp/add.html" %}
    {% csrf_token %}
<table style="font-size: small;" id="invoice" class="invoice table-sortable draggable table-bordered">
    {% include "spareapp/tablesup.html" %}
    {% include "spareapp/tableinf.html" %}
</table>
{% include "spareapp/numPagesDown.html" %}
</form>
</div>

<script>

$(document).on("click",".shopCart",function(){
    div = $(this)
    val = $(this).attr("data-spare")
    quantity = $(this).parent().parent().find("input").val()

    $.ajax({
        method: 'GET',
        url: "/shopCartFunction",
        data: {"val":val,"quantity":quantity},
        success: function (data){

            if(data.save){
                div.parent().html('<div style="font-size: small;color: white;" class="btn btn-danger">Ya está en carrito</div>')
            }
        }
    })
})

// $(".pagination li a").click(function(f){
//     f.preventDefault();
// }

// $(document).on("click","#openS",function(){
function openCart(elemento,a){

    const parametro = elemento.getAttribute("data-parametro")
    const lista = $('#headerList');
    const checkboxesMarcados = lista.find('input[type="checkbox"]').filter(':checked');
    const cantidadMarcados = checkboxesMarcados.length;

    $.ajax({
        method: 'GET',
        url: "/openCar",
        data: {"parametro":parametro,"spare_id":a},
        success: function (data){
            
            if(parametro == '+'){
                elemento.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-dash-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/></svg>'
                tabla = $("#myTable")
                referencia = elemento.parentNode.parentNode
                
                
                if(data.spareBrand.length>0){

                    fila = document.createElement('td')
                    fila.style.display = 'none';
                    fila.style.backgroundColor = '#D2D1D0';
                    fila.setAttribute('id',a);
                    fila.colSpan = 7;

                    for(var i=0;i<data.spareBrand.length;i++){

                        div = document.createElement('div')
                        
                        div.classList.add('align-items-center');
                        div.classList.add('py-3');
                        div.classList.add('row');
                        col1 = document.createElement('div')
                        col1.classList.add('col-5')
                        col1.innerHTML = data.spareBrand[i].brand__brand

                        col2 = document.createElement('div')
                        col2.classList.add('col-2')
                        col2.innerHTML = '$ '+ data.spareBrand[i].brandPrice.toFixed(2)

                        col3 = document.createElement('div')
                        col3.classList.add('col-2')
                        col3.innerHTML = '<input value="0" min="0" step="1" style="max-width: 70px;" class="" type="number">'

                        col4 = document.createElement('div')
                        col4.classList.add('col-3')
                        if(data.cart[data.spareBrand[i].id]){
                            col4.innerHTML = '<div style="font-size: small;color: white;" class="btn btn-danger">Ya está en carrito</div>'
                        }else{
                            col4.innerHTML = '<div data-spare="'+data.spareBrand[i].id+'" style="font-size: small;color: white;" class="btn btn-success shopCart">Añadir al carrito</div>'
                        }
                        
                        div.append(col1)
                        div.append(col2)
                        div.append(col3)
                        div.append(col4)
                        fila.append(div)
                    }
                    referencia.insertAdjacentElement("afterend", fila);
                    $(fila).toggle(500);
                }

            }else{
                elemento.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg>'
                $("#"+a).remove()
            }
            elemento.setAttribute("data-parametro", (parametro === "+") ? "-" : "+");
        }
    })

}

$(document).on("click","li span",function(){

    var pages = $("#maxRows").val()
    var textoSpan = $(this).text();

    atributes = []
    categories = []
    inputs = []
    inputsId = []
    $(".filterAtr:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $(".filterDim:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $("#headerList5 li input:checked").each(function(){
        categories.push($(this).parent().find("label").text())
    })
    $("#hMain th input:not(.check)").each(function(){
        inputsId.push($(this).attr("id"))
        inputs.push($(this).val().toLowerCase())
    })

    var requestVentas = $("#requestVentas").val()
    var superuser = $("#superuser").val()
    var requestBodega = $("#requestBodega").val()
    var requestMayorista = $("#requestMayorista").val()
    var autenticado = $("#autenticado").val()
    var spare_code = null
    var spare_category = null    
    var pageGo = textoSpan

    console.log("Antes de entrar a ajax")
    $.ajax({
        method: 'GET',
        url: "/sortMain2",
        data: {"pageGo":pageGo,"pages":pages,"inputsId[]":inputsId,"inputs[]":inputs,"atributes[]": atributes, "categories[]":categories},
        success: function (data){
            $("#myTable").empty()
            if(data.spare.length>0){
                for(var i=0;i<data.spare.length;i++){
                    // alert(data.sparelist[data.spare[i].id])
                    $("#myTable").append('<tr class="dnd-moved"><tr>')

                    $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><div data-parametro="+" id="openS" style="cursor: pointer;color: rgb(136,12,12);" onclick="openCart(this,'+data.spare[i].id+')"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg></div></td>')
                    // $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><div data-parametro="+" id="openS" style="cursor: pointer;color: rgb(136,12,12);" onclick="'+openCart(this,data.spare[i].id)+'"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg></div></td>')

                    if(data.spare[i].spare_code){
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="/sparedetails/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="#"></a></td>')
                    }

                    $("#myTable .dnd-moved").last().append('<td class="pr-0"><a style="color:rgb(136,12,12);" id="spareEdit" href="/editspare/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')

                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    $("#myTable .dnd-moved td").last().append('<div style="font-weight: bold;" id="spareCodeInfo">'+data.spare[i].spare_code+'</div>')
                    for(var j=0;j<data.reference.length;j++){
                        if(data.spare[i].spare_code == data.reference[j].referenceSpare__spare_code){
                            $("#myTable .dnd-moved td").last().append('<div id="spareCodeInfo">'+data.reference[j].referenceCode+' '+data.reference[j].referenceNote.substr(0, 3)+'</div>')
                        }
                    }

                    $("#myTable .dnd-moved").last().append('<td style="min-width: 100px;max-width: 180px;" class="pr-0"></td>')
                    if(data.sparelist[data.spare[i].id]){
                        data.sparelist[data.spare[i].id].forEach(function(b) {
                            if(data.enginelist[b.id].length>0){
                                console.log(data.enginelist[b.id])
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                data.enginelist[b.id].forEach(function(c) {
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">'+c.engine_ide+' '+c.engine_l+'</div>')
                                })
                                
                            }
                            else{
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">No engines</div>')
                            }
                        });
                    }
                    
                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    for(var y=0;y<data.engine.length;y++){
                        if(data.spare[i].id == data.engine[y].spare){
                            $("#myTable .dnd-moved td").last().append('<div id="spareEngine">'+data.engine[y].engine_l+' '+data.engine[y].engine_ide+'</div>')
                        }
                    }
                    if(data.spare[i].spare_brand){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }
                    $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                    for(var m=0;m<data.category.length;m++){
                        if(data.category[m].id == data.spare[i].spare_category_id){
                            $("#myTable .dnd-moved td").last().append('<div id="categoryInfo">'+data.category[m].category+'</div>')
                        }
                    }
                    if(data.spare[i].spare_name){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div>'+data.spare[i].spare_name+'</div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                        if(data.atributes.length>0){
                            for(n=0;n<data.atributes.length;n++){
                                if(data.spare[i].id == data.atributes[n].atributeSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.atributes[n].atributeName.trim()+'Value"><div style="overflow:hidden" class=""><div class="row"><div id="AtrName" class="col-lg-6 col-md-6 text-end px-0">'+data.atributes[n].atributeName+':</div><div id="AtrVal" class="col-lg-6 col-md-6 text-start px-1">'+data.atributes[n].atributeVal+'</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    // Aqui van las dimensiones
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0">')
                        if(data.dimensions.length>0){
                            for(n=0;n<data.dimensions.length;n++){
                                if(data.spare[i].id == data.dimensions[n].dimensionSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.dimensions[n].atributeName.trim()+'Value"><div class="cantainer"><div class="row"><div id="AtrName" style="position: static;" class="col-lg-6">'+data.dimensions[n].atributeName+'</div><div id="AtrVal" style="position: static;" class="col-lg-6 ms-auto">'+data.dimensions[n].atributeVal+' mm</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_m){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_m+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_d){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_d+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(data.spare[i].spare_photo){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div><div id="mainPhoto" style="background-image: url(\'/media/'+data.spare[i].spare_photo+'\');" class="photo"></div></a></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"></td>')
                        for(var n=0;n<data.vendor.length;n++){
                            if(data.spare[i].id == data.vendor[n].spare){
                                $("#myTable .dnd-moved td").last().append('<div><div id="vendorInfo">'+data.vendor[n].vendorName+'</div></div>')
                            }
                        }
                    }
                    // if(autenticado=="True"){
                    //     $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><input class="check" type="checkbox" name="toAdd" value="'+data.spare[i].id+'"></td>')
                    // }
                }
            }

            let detailidi = $("#detail-id").index();
            let photoi = $("#photo").index();
            let codei = $("#code").index();
            let brandi = $("#brand").index();
            let typei = $("#type").index();
            let cari = $("#car").index();
            let shapei = $("#shape").index();
            let dimensionsi = $("#dimensions").index();
            let atributesi = $("#atributes").index();
            let priceDi = $("#priceD").index();
            let priceMi = $("#priceM").index();
            let referencei = $("#referenceC").index();
            let editSparei = $("#editSpare").index();
            let enginei = $("#engine").index();
            let checki = $("#check").index();
            let ecodei = $("#ecode").index();
            let categoryi = $("#category").index();
            let vendori = $("#vendor").index();

            if ($("input:checkbox[name=detail-id]:checked").val()){
                $("#detail-id").show();
                $("table td:nth-child("+(detailidi + 1)+")").show();
            }else{
                $("#detail-id").hide();
                $("table td:nth-child("+(detailidi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceM]:checked").val()){
                $("#priceM").show();
                $("table td:nth-child("+(priceMi + 1)+")").show();
            }else{
                $("#priceM").hide();
                $("table td:nth-child("+(priceMi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceD]:checked").val()){
                $("#priceD").show();
                $("table td:nth-child("+(priceDi + 1)+")").show();
            }else{
                $("#priceD").hide();
                $("table td:nth-child("+(priceDi + 1)+")").hide();
            }

            if ($("input:checkbox[name=photo]:checked").val()){
                $("#photo").show();
                $("table td:nth-child("+(photoi + 1)+")").show();
            }else{
                $("#photo").hide();
                $("table td:nth-child("+(photoi + 1)+")").hide();
            }

            if ($("input:checkbox[name=code]:checked").val()){
                $("#code").show();
                $("table td:nth-child("+(codei + 1)+")").show();
            }else{
                $("#code").hide();
                $("table td:nth-child("+(codei + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=brand]:checked").val()){
                $("#brand").show();
                $("table td:nth-child("+(brandi + 1)+")").show();
            }else{
                $("#brand").hide();
                $("table td:nth-child("+(brandi + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=type]:checked").val()){
                $("#type").show();
                $("table td:nth-child("+(typei + 1)+")").show();
            }else{
                $("#type").hide();
                $("table td:nth-child("+(typei + 1)+")").hide();
            }

            if ($("input:checkbox[name=car]:checked").val()){
                $("#car").show();
                $("table td:nth-child("+(cari + 1)+")").show();
            }else{
                $("#car").hide();
                $("table td:nth-child("+(cari + 1)+")").hide();
            }

            if ($("input:checkbox[name=shape]:checked").val()){
                $("#shape").show();
                $("table td:nth-child("+(shapei + 1)+")").show();
            }else{
                $("#shape").hide();
                $("table td:nth-child("+(shapei + 1)+")").hide();
            }

            if ($("input:checkbox[name=dimensions]:checked").val()){
                $("#dimensions").show();
                $("table td:nth-child("+(dimensionsi + 1)+")").show();
            }else{
                $("#dimensions").hide();
                $("table td:nth-child("+(dimensionsi + 1)+")").hide();
            }

            if ($("input:checkbox[name=atributes]:checked").val()){
                $("#atributes").show();
                $("table td:nth-child("+(atributesi + 1)+")").show();
            }else{
                $("#atributes").hide();
                $("table td:nth-child("+(atributesi + 1)+")").hide();
            }

            if ($("input:checkbox[name=check]:checked").val()){
                $("#check").show();
                $("table td:nth-child("+(checki + 1)+")").show();
            }else{
                $("#check").hide();
                $("table td:nth-child("+(checki + 1)+")").hide();
            }

            if ($("input:checkbox[name=referenceC]:checked").val()){
                $("#referenceC").show();
                $("table td:nth-child("+(referencei + 1)+")").show();
            }else{
                $("#referenceC").hide();
                $("table td:nth-child("+(referencei + 1)+")").hide();
            }

            if ($("input:checkbox[name=editSpare]:checked").val()){
                $("#editSpare").show();
                $("table td:nth-child("+(editSparei + 1)+")").show();
            }else{
                $("#editSpare").hide();
                $("table td:nth-child("+(editSparei + 1)+")").hide();
            }

            if ($("input:checkbox[name=engine]:checked").val()){
                $("#engine").show();
                $("table td:nth-child("+(enginei + 1)+")").show();
            }else{
                $("#engine").hide();
                $("table td:nth-child("+(enginei + 1)+")").hide();
            }

            if ($("input:checkbox[name=ecode]:checked").val()){
                $("#ecode").show();
                $("table td:nth-child("+(ecodei + 1)+")").show();
            }else{
                $("#ecode").hide();
                $("table td:nth-child("+(ecodei + 1)+")").hide();
            }

            if ($("input:checkbox[name=category]:checked").val()){
                $("#category").show();
                $("table td:nth-child("+(categoryi + 1)+")").show();
            }else{
                $("#category").hide();
                $("table td:nth-child("+(categoryi + 1)+")").hide();
            }

            if ($("input:checkbox[name=vendor]:checked").val()){
                $("#vendor").show();
                $("table td:nth-child("+(vendori + 1)+")").show();
            }else{
                $("#vendor").hide();
                $("table td:nth-child("+(vendori + 1)+")").hide();
            }

            // Paginacion
            $(".pagination").empty()
            for(i=1;i<=data.numeros.length;i++){
                if(data.actual == i){
                    $(".pagination").append('<li class="page-a active"><span class="sr-only">'+i+'</span></li>')
                }else{
                    $(".pagination").append('<li class="page-a"><span class="sr-only">'+i+'</span></li>')
                }
            }
        }
    })

})

$("#reference").hide();
$("table td:nth-child("+($("#reference").index() + 1)+")").hide();

function filtrar(a){

    $("#hMain th").each(function(){
        if(a==$(this).attr("id")){
            $(this).find("span")[0].innerHTML = "<input id='input"+a+"' name='input"+a+"' style='max-width: 100px;' type='text' placeholder="+a+"></input>"
        }
    })
    $("#input"+a).select();

    $("#hMain th input").on("keyup",function(){

        atributes = []
        categories = []
        inputs = []
        inputsId = []

        $(".filterAtr:visible").each(function(){
            atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
        })
        $(".filterDim:visible").each(function(){
            atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
        })
        $("#headerList5 li input:checked").each(function(){
            categories.push($(this).parent().find("label").text())
        })
        $("#hMain th input:not(.check)").each(function(){
            inputsId.push($(this).attr("id"))
            inputs.push($(this).val().toLowerCase())
        })

        var requestVentas = $("#requestVentas").val()
        var superuser = $("#superuser").val()
        var requestBodega = $("#requestBodega").val()
        var requestMayorista = $("#requestMayorista").val()
        var autenticado = $("#autenticado").val()
        var spare_code = null
        var spare_category = null
        var pages = $("#maxRows").val()

        $.ajax({
            method: 'GET',
            url: "/sortMain2",
            data: {"pages":pages,"inputsId[]":inputsId,"inputs[]":inputs,"atributes[]": atributes, "categories[]":categories},
            success: function (data){
                $("#myTable").empty()
                // alert(data.spare.length)
                if(data.spare.length>0){
                    for(var i=0;i<data.spare.length;i++){
                        $("#myTable").append('<tr class="dnd-moved"><tr>')

                        $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><div data-parametro="+" id="openS" style="cursor: pointer;color: rgb(136,12,12);" onclick="openCart(this,'+data.spare[i].id+')"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg></div></td>')

                        if(data.spare[i].spare_code){
                            $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="/sparedetails/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="#"></a></td>')
                        }

                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><a style="color:rgb(136,12,12);" id="spareEdit" href="/editspare/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')

                        $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                        $("#myTable .dnd-moved td").last().append('<div style="font-weight: bold;" id="spareCodeInfo">'+data.spare[i].spare_code+'</div>')
                        for(var j=0;j<data.reference.length;j++){
                            if(data.spare[i].spare_code == data.reference[j].referenceSpare__spare_code){
                                $("#myTable .dnd-moved td").last().append('<div id="spareCodeInfo">'+data.reference[j].referenceCode+' '+data.reference[j].referenceNote.substr(0, 3)+'</div>')
                            }
                        }
                        $("#myTable .dnd-moved").last().append('<td style="min-width: 100px;max-width: 180px;" class="pr-0"></td>')
                        if(data.sparelist[data.spare[i].id]){
                            data.sparelist[data.spare[i].id].forEach(function(b) {
                                if(data.enginelist[b.id].length>0){
                                    console.log(data.enginelist[b.id])
                                    $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                    data.enginelist[b.id].forEach(function(c) {
                                        $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                        $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">'+c.engine_ide+' '+c.engine_l+'</div>')
                                    })
                                    
                                }
                                else{
                                    $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">No engines</div>')
                                }
                            });
                        }
                        // $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                        // for(var z=0;z<data.car.length;z++){
                        //     if(data.spare[i].id == data.car[z].spare){
                        //         $("#myTable .dnd-moved td").last().append('<div id="spareCar">'+data.car[z].car_manufacturer__manufacturer.substr(0, 3)+' '+data.car[z].car_model+' '+data.car[z].carfrom+' '+data.car[z].chasis+'</div>')
                        //     }
                        // }
                        $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                        for(var y=0;y<data.engine.length;y++){
                            if(data.spare[i].id == data.engine[y].spare){
                                $("#myTable .dnd-moved td").last().append('<div id="spareEngine">'+data.engine[y].engine_l+' '+data.engine[y].engine_ide+'</div>')
                            }
                        }
                        if(data.spare[i].spare_brand){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                        }
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                        for(var m=0;m<data.category.length;m++){
                            if(data.category[m].id == data.spare[i].spare_category_id){
                                $("#myTable .dnd-moved td").last().append('<div id="categoryInfo">'+data.category[m].category+'</div>')
                            }
                        }
                        if(data.spare[i].spare_name){
                            $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div>'+data.spare[i].spare_name+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div></div></td>')
                        }
                        if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                            $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                            if(data.atributes.length>0){
                                for(n=0;n<data.atributes.length;n++){
                                    if(data.spare[i].id == data.atributes[n].atributeSpare){
                                        $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.atributes[n].atributeName.trim()+'Value"><div style="overflow:hidden" class=""><div class="row"><div id="AtrName" class="col-lg-6 col-md-6 text-end px-0">'+data.atributes[n].atributeName+':</div><div id="AtrVal" class="col-lg-6 col-md-6 text-start px-1">'+data.atributes[n].atributeVal+'</div></div></div></div></div>')
                                    }
                                }
                            }
                        }
                        // Aqui van las dimensiones
                        if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                            $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0">')
                            if(data.dimensions.length>0){
                                for(n=0;n<data.dimensions.length;n++){
                                    if(data.spare[i].id == data.dimensions[n].dimensionSpare){
                                        $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.dimensions[n].atributeName.trim()+'Value"><div class="cantainer"><div class="row"><div id="AtrName" style="position: static;" class="col-lg-6">'+data.dimensions[n].atributeName+'</div><div id="AtrVal" style="position: static;" class="col-lg-6 ms-auto">'+data.dimensions[n].atributeVal+' mm</div></div></div></div></div>')
                                    }
                                }
                            }
                        }
                        if(superuser=="True"){
                            if(data.spare[i].price_m){
                                $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_m+'</div></td>')
                            }else{
                                $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                            }
                        }
                        if(superuser=="True"){
                            if(data.spare[i].price_d){
                                $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_d+'</div></td>')
                            }else{
                                $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                            }
                        }
                        if(data.spare[i].spare_photo){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0"><div><div id="mainPhoto" style="background-image: url(\'/media/'+data.spare[i].spare_photo+'\');" class="photo"></div></a></div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0"><div></div></td>')
                        }
                        if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"></td>')
                            for(var n=0;n<data.vendor.length;n++){
                                if(data.spare[i].id == data.vendor[n].spare){
                                    $("#myTable .dnd-moved td").last().append('<div><div id="vendorInfo">'+data.vendor[n].vendorName+'</div></div>')
                                }
                            }
                        }
                        // if(autenticado=="True"){
                        //     $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><input class="check" type="checkbox" name="toAdd" value="'+data.spare[i].id+'"></td>')
                        // }
                    }
                }

                let detailidi = $("#detail-id").index();
                let photoi = $("#photo").index();
                let codei = $("#code").index();
                let brandi = $("#brand").index();
                let typei = $("#type").index();
                let cari = $("#car").index();
                let shapei = $("#shape").index();
                let dimensionsi = $("#dimensions").index();
                let atributesi = $("#atributes").index();
                let priceDi = $("#priceD").index();
                let priceMi = $("#priceM").index();
                let referencei = $("#referenceC").index();
                let editSparei = $("#editSpare").index();
                let enginei = $("#engine").index();
                let checki = $("#check").index();
                let ecodei = $("#ecode").index();
                let categoryi = $("#category").index();
                let vendori = $("#vendor").index();

                if ($("input:checkbox[name=detail-id]:checked").val()){
                    $("#detail-id").show();
                    $("table td:nth-child("+(detailidi + 1)+")").show();
                }else{
                    $("#detail-id").hide();
                    $("table td:nth-child("+(detailidi + 1)+")").hide();
                }

                if ($("input:checkbox[name=priceM]:checked").val()){
                    $("#priceM").show();
                    $("table td:nth-child("+(priceMi + 1)+")").show();
                }else{
                    $("#priceM").hide();
                    $("table td:nth-child("+(priceMi + 1)+")").hide();
                }

                if ($("input:checkbox[name=priceD]:checked").val()){
                    $("#priceD").show();
                    $("table td:nth-child("+(priceDi + 1)+")").show();
                }else{
                    $("#priceD").hide();
                    $("table td:nth-child("+(priceDi + 1)+")").hide();
                }

                if ($("input:checkbox[name=photo]:checked").val()){
                    $("#photo").show();
                    $("table td:nth-child("+(photoi + 1)+")").show();
                }else{
                    $("#photo").hide();
                    $("table td:nth-child("+(photoi + 1)+")").hide();
                }

                if ($("input:checkbox[name=code]:checked").val()){
                    $("#code").show();
                    $("table td:nth-child("+(codei + 1)+")").show();
                }else{
                    $("#code").hide();
                    $("table td:nth-child("+(codei + 1)+")").hide();
                }
                
                if ($("input:checkbox[name=brand]:checked").val()){
                    $("#brand").show();
                    $("table td:nth-child("+(brandi + 1)+")").show();
                }else{
                    $("#brand").hide();
                    $("table td:nth-child("+(brandi + 1)+")").hide();
                }
                
                if ($("input:checkbox[name=type]:checked").val()){
                    $("#type").show();
                    $("table td:nth-child("+(typei + 1)+")").show();
                }else{
                    $("#type").hide();
                    $("table td:nth-child("+(typei + 1)+")").hide();
                }

                if ($("input:checkbox[name=car]:checked").val()){
                    $("#car").show();
                    $("table td:nth-child("+(cari + 1)+")").show();
                }else{
                    $("#car").hide();
                    $("table td:nth-child("+(cari + 1)+")").hide();
                }

                if ($("input:checkbox[name=shape]:checked").val()){
                    $("#shape").show();
                    $("table td:nth-child("+(shapei + 1)+")").show();
                }else{
                    $("#shape").hide();
                    $("table td:nth-child("+(shapei + 1)+")").hide();
                }

                if ($("input:checkbox[name=dimensions]:checked").val()){
                    $("#dimensions").show();
                    $("table td:nth-child("+(dimensionsi + 1)+")").show();
                }else{
                    $("#dimensions").hide();
                    $("table td:nth-child("+(dimensionsi + 1)+")").hide();
                }

                if ($("input:checkbox[name=atributes]:checked").val()){
                    $("#atributes").show();
                    $("table td:nth-child("+(atributesi + 1)+")").show();
                }else{
                    $("#atributes").hide();
                    $("table td:nth-child("+(atributesi + 1)+")").hide();
                }

                if ($("input:checkbox[name=check]:checked").val()){
                    $("#check").show();
                    $("table td:nth-child("+(checki + 1)+")").show();
                }else{
                    $("#check").hide();
                    $("table td:nth-child("+(checki + 1)+")").hide();
                }

                if ($("input:checkbox[name=referenceC]:checked").val()){
                    $("#referenceC").show();
                    $("table td:nth-child("+(referencei + 1)+")").show();
                }else{
                    $("#referenceC").hide();
                    $("table td:nth-child("+(referencei + 1)+")").hide();
                }

                if ($("input:checkbox[name=editSpare]:checked").val()){
                    $("#editSpare").show();
                    $("table td:nth-child("+(editSparei + 1)+")").show();
                }else{
                    $("#editSpare").hide();
                    $("table td:nth-child("+(editSparei + 1)+")").hide();
                }

                if ($("input:checkbox[name=engine]:checked").val()){
                    $("#engine").show();
                    $("table td:nth-child("+(enginei + 1)+")").show();
                }else{
                    $("#engine").hide();
                    $("table td:nth-child("+(enginei + 1)+")").hide();
                }

                if ($("input:checkbox[name=ecode]:checked").val()){
                    $("#ecode").show();
                    $("table td:nth-child("+(ecodei + 1)+")").show();
                }else{
                    $("#ecode").hide();
                    $("table td:nth-child("+(ecodei + 1)+")").hide();
                }

                if ($("input:checkbox[name=category]:checked").val()){
                    $("#category").show();
                    $("table td:nth-child("+(categoryi + 1)+")").show();
                }else{
                    $("#category").hide();
                    $("table td:nth-child("+(categoryi + 1)+")").hide();
                }

                if ($("input:checkbox[name=vendor]:checked").val()){
                    $("#vendor").show();
                    $("table td:nth-child("+(vendori + 1)+")").show();
                }else{
                    $("#vendor").hide();
                    $("table td:nth-child("+(vendori + 1)+")").hide();
                }

                // Paginacion
                $(".pagination").empty()
                for(i=1;i<=data.numeros.length;i++){
                    if(data.actual == i){
                        $(".pagination").append('<li class="page-a active"><span class="sr-only">'+i+'</span></li>')
                    }else{
                        $(".pagination").append('<li class="page-a"><span class="sr-only">'+i+'</span></li>')
                    }
                }
            }
        });
    })
    // $("#input"+a).select();

    // $("#hMain th").each(function(){
    //     var bandcode = false
    //     var bandeditSpare = false
    //     var bandreferenceC = false
    //     var bandcar = false
    //     var bandengine = false
    //     var bandbrand = false
    //     var bandcategory = false
    //     var bandtype = false
    //     var bandatributes = false
    //     var banddimensions = false
    //     var bandpriceM = false
    //     var bandpriceD = false
    //     var bandecode = false
    //     var bandvendor = false

    //     $("#hMain th input").on("keyup",function(){
    //         var valuecode = false
    //         var valueeditSpare = false
    //         var valuereferenceC = false
    //         var valuecar = false
    //         var valueengine = false
    //         var valuebrand = false
    //         var valuecategory = false
    //         var valuetype = false
    //         var valueatributes = false
    //         var valuedimensions = false
    //         var valuepriceM = false
    //         var valuepriceD = false
    //         var valueecode = false
    //         var valuevendor = false
    //         $("#hMain th input").each(function(){
    //             if($(this).attr("id")=="inputcode"){
    //                 valuecode = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputeditSpare"){
    //                 valueeditSpare = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputreferenceC"){
    //                 valuereferenceC = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputcar"){
    //                 valuecar = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputengine"){
    //                 valueengine = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputbrand"){
    //                 valuebrand = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputcategory"){
    //                 valuecategory = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputtype"){
    //                 valuetype = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputatributes"){
    //                 valueatributes = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputdimensions"){
    //                 valuedimensions = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputpriceM"){
    //                 valuepriceM = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputpriceD"){
    //                 valuepriceD = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputecode"){
    //                 valueecode = $(this).val().toLowerCase()
    //             }
    //             if($(this).attr("id")=="inputvendor"){
    //                 valuevendor = $(this).val().toLowerCase()
    //             }
    //         })
    //         $("#myTable tr").each(function(){
    //             bandcode = false
    //             bandeditSpare = false
    //             bandreferenceC = false
    //             bandcar = false
    //             bandengine = false
    //             bandbrand = false
    //             bandcategory = false
    //             bandtype = false
    //             bandatributes = false
    //             banddimensions = false
    //             bandpriceM = false
    //             bandpriceD = false
    //             bandecode = false
    //             bandvendor = false
    //             $(this).find("td").each(function(){
    //                 if($(this).index()==0 && $(this).text().toLowerCase().indexOf(valuecode) > -1 || valuecode == false){
    //                     bandcode = true
    //                 }
    //                 if($(this).index()==1 && $(this).text().toLowerCase().indexOf(valueeditSpare) > -1 || valueeditSpare == false){
    //                     bandeditSpare = true
    //                 }
    //                 if($(this).index()==2 && $(this).text().toLowerCase().indexOf(valuereferenceC) > -1 || valuereferenceC == false){
    //                     bandreferenceC = true
    //                 }
    //                 if($(this).index()==3 && $(this).text().toLowerCase().indexOf(valuecar) > -1 || valuecar == false){
    //                     bandcar = true
    //                 }
    //                 if($(this).index()==4 && $(this).text().toLowerCase().indexOf(valueengine) > -1 || valueengine == false){
    //                     bandengine = true
    //                 }
    //                 if($(this).index()==5 && $(this).text().toLowerCase().indexOf(valuebrand) > -1 || valuebrand == false){
    //                     bandbrand = true
    //                 }
    //                 if($(this).index()==6 && $(this).text().toLowerCase().indexOf(valuecategory) > -1 || valuecategory == false){
    //                     bandcategory = true
    //                 }
    //                 if($(this).index()==7 && $(this).text().toLowerCase().indexOf(valuetype) > -1 || valuetype == false){
    //                     bandtype = true
    //                 }
    //                 if($(this).index()==8 && $(this).text().toLowerCase().indexOf(valueatributes) > -1 || valueatributes == false){
    //                     bandatributes = true
    //                 }
    //                 if($(this).index()==9 && $(this).text().toLowerCase().indexOf(valuedimensions) > -1 || valuedimensions == false){
    //                     banddimensions = true
    //                 }
    //                 if($(this).index()==10 && $(this).text().toLowerCase().indexOf(valuepriceM) > -1 || valuepriceM == false){
    //                     bandpriceM = true
    //                 }
    //                 if($(this).index()==11 && $(this).text().toLowerCase().indexOf(valuepriceD) > -1 || valuepriceD == false){
    //                     bandpriceD = true
    //                 }
    //                 if($(this).index()==13 && $(this).text().toLowerCase().indexOf(valueecode) > -1 || valueecode == false){
    //                     bandecode = true
    //                 }
    //                 if($(this).index()==14 && $(this).text().toLowerCase().indexOf(valuevendor) > -1 || valuevendor == false){
    //                     bandvendor = true
    //                 }
    //             })
    //             $(this).toggle(bandcode && bandeditSpare && bandreferenceC && bandcar && bandengine && bandbrand && bandcategory && bandtype && bandatributes && banddimensions && bandpriceM && bandpriceD && bandecode && bandvendor)
    //         })
    //     })
    // })
}

$("#maxRows").on("change",function(){

    var pages = $("#maxRows").val()

    atributes = []
    categories = []
    inputs = []
    inputsId = []
    $(".filterAtr:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $(".filterDim:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $("#headerList5 li input:checked").each(function(){
        categories.push($(this).parent().find("label").text())
    })
    $("#hMain th input:not(.check)").each(function(){
        inputsId.push($(this).attr("id"))
        inputs.push($(this).val().toLowerCase())
    })

    var requestVentas = $("#requestVentas").val()
    var superuser = $("#superuser").val()
    var requestBodega = $("#requestBodega").val()
    var requestMayorista = $("#requestMayorista").val()
    var autenticado = $("#autenticado").val()
    var spare_code = null
    var spare_category = null    

    $.ajax({
        method: 'GET',
        url: "/sortMain2",
        data: {"pages":pages,"inputsId[]":inputsId,"inputs[]":inputs,"atributes[]": atributes, "categories[]":categories},
        success: function (data){
            $("#myTable").empty()
            if(data.spare.length>0){
                for(var i=0;i<data.spare.length;i++){
                    $("#myTable").append('<tr class="dnd-moved"><tr>')

                    $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><div data-parametro="+" id="openS" style="cursor: pointer;color: rgb(136,12,12);" onclick="openCart(this,'+data.spare[i].id+')"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg></div></td>')

                    if(data.spare[i].spare_code){
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="/sparedetails/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="#"></a></td>')
                    }

                    $("#myTable .dnd-moved").last().append('<td class="pr-0"><a style="color:rgb(136,12,12);" id="spareEdit" href="/editspare/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')

                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    $("#myTable .dnd-moved td").last().append('<div style="font-weight: bold;" id="spareCodeInfo">'+data.spare[i].spare_code+'</div>')
                    for(var j=0;j<data.reference.length;j++){
                        if(data.spare[i].spare_code == data.reference[j].referenceSpare__spare_code){
                            $("#myTable .dnd-moved td").last().append('<div id="spareCodeInfo">'+data.reference[j].referenceCode+' '+data.reference[j].referenceNote.substr(0, 3)+'</div>')
                        }
                    }
                    $("#myTable .dnd-moved").last().append('<td style="min-width: 100px;max-width: 180px;" class="pr-0"></td>')
                    if(data.sparelist[data.spare[i].id]){
                        data.sparelist[data.spare[i].id].forEach(function(b) {
                            if(data.enginelist[b.id].length>0){
                                console.log(data.enginelist[b.id])
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                data.enginelist[b.id].forEach(function(c) {
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">'+c.engine_ide+' '+c.engine_l+'</div>')
                                })
                                
                            }
                            else{
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">No engines</div>')
                            }
                        });
                    }
                    // $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    // for(var z=0;z<data.car.length;z++){
                    //     if(data.spare[i].id == data.car[z].spare){
                    //         $("#myTable .dnd-moved td").last().append('<div id="spareCar">'+data.car[z].car_manufacturer__manufacturer.substr(0, 3)+' '+data.car[z].car_model+' '+data.car[z].carfrom+' '+data.car[z].chasis+'</div>')
                    //     }
                    // }
                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    for(var y=0;y<data.engine.length;y++){
                        if(data.spare[i].id == data.engine[y].spare){
                            $("#myTable .dnd-moved td").last().append('<div id="spareEngine">'+data.engine[y].engine_l+' '+data.engine[y].engine_ide+'</div>')
                        }
                    }
                    if(data.spare[i].spare_brand){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }
                    $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                    for(var m=0;m<data.category.length;m++){
                        if(data.category[m].id == data.spare[i].spare_category_id){
                            $("#myTable .dnd-moved td").last().append('<div id="categoryInfo">'+data.category[m].category+'</div>')
                        }
                    }
                    if(data.spare[i].spare_name){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div>'+data.spare[i].spare_name+'</div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                        if(data.atributes.length>0){
                            for(n=0;n<data.atributes.length;n++){
                                if(data.spare[i].id == data.atributes[n].atributeSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.atributes[n].atributeName.trim()+'Value"><div style="overflow:hidden" class=""><div class="row"><div id="AtrName" class="col-lg-6 col-md-6 text-end px-0">'+data.atributes[n].atributeName+':</div><div id="AtrVal" class="col-lg-6 col-md-6 text-start px-1">'+data.atributes[n].atributeVal+'</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    // Aqui van las dimensiones
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0">')
                        if(data.dimensions.length>0){
                            for(n=0;n<data.dimensions.length;n++){
                                if(data.spare[i].id == data.dimensions[n].dimensionSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.dimensions[n].atributeName.trim()+'Value"><div class="cantainer"><div class="row"><div id="AtrName" style="position: static;" class="col-lg-6">'+data.dimensions[n].atributeName+'</div><div id="AtrVal" style="position: static;" class="col-lg-6 ms-auto">'+data.dimensions[n].atributeVal+' mm</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_m){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_m+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_d){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_d+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(data.spare[i].spare_photo){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div><div id="mainPhoto" style="background-image: url(\'/media/'+data.spare[i].spare_photo+'\');" class="photo"></div></a></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"></td>')
                        for(var n=0;n<data.vendor.length;n++){
                            if(data.spare[i].id == data.vendor[n].spare){
                                $("#myTable .dnd-moved td").last().append('<div><div id="vendorInfo">'+data.vendor[n].vendorName+'</div></div>')
                            }
                        }
                    }
                    // if(autenticado=="True"){
                    //     $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><input class="check" type="checkbox" name="toAdd" value="'+data.spare[i].id+'"></td>')
                    // }
                }
            }

            let detailidi = $("#detail-id").index();
            let photoi = $("#photo").index();
            let codei = $("#code").index();
            let brandi = $("#brand").index();
            let typei = $("#type").index();
            let cari = $("#car").index();
            let shapei = $("#shape").index();
            let dimensionsi = $("#dimensions").index();
            let atributesi = $("#atributes").index();
            let priceDi = $("#priceD").index();
            let priceMi = $("#priceM").index();
            let referencei = $("#referenceC").index();
            let editSparei = $("#editSpare").index();
            let enginei = $("#engine").index();
            let checki = $("#check").index();
            let ecodei = $("#ecode").index();
            let categoryi = $("#category").index();
            let vendori = $("#vendor").index();

            if ($("input:checkbox[name=detail-id]:checked").val()){
                $("#detail-id").show();
                $("table td:nth-child("+(detailidi + 1)+")").show();
            }else{
                $("#detail-id").hide();
                $("table td:nth-child("+(detailidi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceM]:checked").val()){
                $("#priceM").show();
                $("table td:nth-child("+(priceMi + 1)+")").show();
            }else{
                $("#priceM").hide();
                $("table td:nth-child("+(priceMi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceD]:checked").val()){
                $("#priceD").show();
                $("table td:nth-child("+(priceDi + 1)+")").show();
            }else{
                $("#priceD").hide();
                $("table td:nth-child("+(priceDi + 1)+")").hide();
            }

            if ($("input:checkbox[name=photo]:checked").val()){
                $("#photo").show();
                $("table td:nth-child("+(photoi + 1)+")").show();
            }else{
                $("#photo").hide();
                $("table td:nth-child("+(photoi + 1)+")").hide();
            }

            if ($("input:checkbox[name=code]:checked").val()){
                $("#code").show();
                $("table td:nth-child("+(codei + 1)+")").show();
            }else{
                $("#code").hide();
                $("table td:nth-child("+(codei + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=brand]:checked").val()){
                $("#brand").show();
                $("table td:nth-child("+(brandi + 1)+")").show();
            }else{
                $("#brand").hide();
                $("table td:nth-child("+(brandi + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=type]:checked").val()){
                $("#type").show();
                $("table td:nth-child("+(typei + 1)+")").show();
            }else{
                $("#type").hide();
                $("table td:nth-child("+(typei + 1)+")").hide();
            }

            if ($("input:checkbox[name=car]:checked").val()){
                $("#car").show();
                $("table td:nth-child("+(cari + 1)+")").show();
            }else{
                $("#car").hide();
                $("table td:nth-child("+(cari + 1)+")").hide();
            }

            if ($("input:checkbox[name=shape]:checked").val()){
                $("#shape").show();
                $("table td:nth-child("+(shapei + 1)+")").show();
            }else{
                $("#shape").hide();
                $("table td:nth-child("+(shapei + 1)+")").hide();
            }

            if ($("input:checkbox[name=dimensions]:checked").val()){
                $("#dimensions").show();
                $("table td:nth-child("+(dimensionsi + 1)+")").show();
            }else{
                $("#dimensions").hide();
                $("table td:nth-child("+(dimensionsi + 1)+")").hide();
            }

            if ($("input:checkbox[name=atributes]:checked").val()){
                $("#atributes").show();
                $("table td:nth-child("+(atributesi + 1)+")").show();
            }else{
                $("#atributes").hide();
                $("table td:nth-child("+(atributesi + 1)+")").hide();
            }

            if ($("input:checkbox[name=check]:checked").val()){
                $("#check").show();
                $("table td:nth-child("+(checki + 1)+")").show();
            }else{
                $("#check").hide();
                $("table td:nth-child("+(checki + 1)+")").hide();
            }

            if ($("input:checkbox[name=referenceC]:checked").val()){
                $("#referenceC").show();
                $("table td:nth-child("+(referencei + 1)+")").show();
            }else{
                $("#referenceC").hide();
                $("table td:nth-child("+(referencei + 1)+")").hide();
            }

            if ($("input:checkbox[name=editSpare]:checked").val()){
                $("#editSpare").show();
                $("table td:nth-child("+(editSparei + 1)+")").show();
            }else{
                $("#editSpare").hide();
                $("table td:nth-child("+(editSparei + 1)+")").hide();
            }

            if ($("input:checkbox[name=engine]:checked").val()){
                $("#engine").show();
                $("table td:nth-child("+(enginei + 1)+")").show();
            }else{
                $("#engine").hide();
                $("table td:nth-child("+(enginei + 1)+")").hide();
            }

            if ($("input:checkbox[name=ecode]:checked").val()){
                $("#ecode").show();
                $("table td:nth-child("+(ecodei + 1)+")").show();
            }else{
                $("#ecode").hide();
                $("table td:nth-child("+(ecodei + 1)+")").hide();
            }

            if ($("input:checkbox[name=category]:checked").val()){
                $("#category").show();
                $("table td:nth-child("+(categoryi + 1)+")").show();
            }else{
                $("#category").hide();
                $("table td:nth-child("+(categoryi + 1)+")").hide();
            }

            if ($("input:checkbox[name=vendor]:checked").val()){
                $("#vendor").show();
                $("table td:nth-child("+(vendori + 1)+")").show();
            }else{
                $("#vendor").hide();
                $("table td:nth-child("+(vendori + 1)+")").hide();
            }

            // Paginacion
            $(".pagination").empty()
            for(i=1;i<=data.numeros.length;i++){
                if(data.actual == i){
                    $(".pagination").append('<li class="page-a active"><span class="sr-only">'+i+'</span></li>')
                }else{
                    $(".pagination").append('<li class="page-a"><span class="sr-only">'+i+'</span></li>')
                }
            }

        }
    })
})

function sort(a,b){
    var table, rows, switching, i, x, y, shouldSwitch, change;
    table = document.getElementById("myTable").getElementsByTagName("tr")
    if(b == 'desc'){
        if($("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0]){
            $("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0].setAttribute("value",$("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0].value)
        }
        $("#hMain th")[a].innerHTML = '<i onclick="sort('+a+',\'asc\')" class="bi bi-arrow-up-short"></i><span onclick="filtrar(\''+$("#hMain th")[a].getAttribute("id")+'\')">'+$("#hMain th")[a].getElementsByTagName("span")[0].innerHTML+'</span>'
    }else{
        if($("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0]){
            $("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0].setAttribute("value",$("#hMain th")[a].getElementsByTagName("span")[0].getElementsByTagName("input")[0].value)
        }
        $("#hMain th")[a].innerHTML = '<i onclick="sort('+a+',\'desc\')" class="bi bi-arrow-down-short"></i><span onclick="filtrar(\''+$("#hMain th")[a].getAttribute("id")+'\')">'+$("#hMain th")[a].getElementsByTagName("span")[0].innerHTML+'</span>'
    }

    atributes = []
    categories = []
    inputs = []
    inputsId = []
    $(".filterAtr:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $(".filterDim:visible").each(function(){
        atributes.push($(this).find(".atrUnique").attr("id")+":"+$(this).find(".atrUnique").val())
    })
    $("#headerList5 li input:checked").each(function(){
        categories.push($(this).parent().find("label").text())
    })
    $("#hMain th input:not(.check)").each(function(){
        inputsId.push($(this).attr("id"))
        inputs.push($(this).val().toLowerCase())
    })

    var requestVentas = $("#requestVentas").val()
    var superuser = $("#superuser").val()
    var requestBodega = $("#requestBodega").val()
    var requestMayorista = $("#requestMayorista").val()
    var autenticado = $("#autenticado").val()
    var spare_code = null
    var spare_category = null
    var pages = $("#maxRows").val()
    $.ajax({
        method: 'GET',
        url: "/sortMain2",
        data: {"pages":pages,"inputsId[]":inputsId,"inputs[]":inputs,"atributes[]": atributes, "categories[]":categories,"a":a,"b":b},
        success: function (data){
            $("#myTable").empty()
            // alert(data.spare.length)
            if(data.spare.length>0){
                for(var i=0;i<data.spare.length;i++){
                    $("#myTable").append('<tr class="dnd-moved"><tr>')

                    $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><div data-parametro="+" id="openS" style="cursor: pointer;color: rgb(136,12,12);" onclick="openCart(this,'+data.spare[i].id+')"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></svg></div></td>')

                    if(data.spare[i].spare_code){
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="/sparedetails/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="display: none;" class="pr-0"><a id="spareCode" href="#"></a></td>')
                    }

                    $("#myTable .dnd-moved").last().append('<td class="pr-0"><a style="color:rgb(136,12,12);" id="spareEdit" href="/editspare/'+data.spare[i].id+'">'+data.spare[i].spare_code+'</a></td>')

                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    $("#myTable .dnd-moved td").last().append('<div style="font-weight: bold;" id="spareCodeInfo">'+data.spare[i].spare_code+'</div>')
                    for(var j=0;j<data.reference.length;j++){
                        if(data.spare[i].spare_code == data.reference[j].referenceSpare__spare_code){
                            $("#myTable .dnd-moved td").last().append('<div id="spareCodeInfo">'+data.reference[j].referenceCode+' '+data.reference[j].referenceNote.substr(0, 3)+'</div>')
                        }
                    }
                    $("#myTable .dnd-moved").last().append('<td style="min-width: 100px;max-width: 180px;" class="pr-0"></td>')
                    if(data.sparelist[data.spare[i].id]){
                        data.sparelist[data.spare[i].id].forEach(function(b) {
                            if(data.enginelist[b.id].length>0){
                                console.log(data.enginelist[b.id])
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                data.enginelist[b.id].forEach(function(c) {
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                    $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">'+c.engine_ide+' '+c.engine_l+'</div>')
                                })
                                
                            }
                            else{
                                $("#myTable .dnd-moved td").last().append('<div class="row"></div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-end px-0" id="spareCar">'+data.carName[b.id].substr(0, 3)+' '+b.car_model+' '+b.carfrom+' '+b.chasis+':</div>')
                                $("#myTable .dnd-moved td div.row").last().append('<div class="col-lg-6 col-md-6 text-start px-1" id="spareEngine">No engines</div>')
                            }
                        });
                    }
                    // $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    // for(var z=0;z<data.car.length;z++){
                    //     if(data.spare[i].id == data.car[z].spare){
                    //         $("#myTable .dnd-moved td").last().append('<div id="spareCar">'+data.car[z].car_manufacturer__manufacturer.substr(0, 3)+' '+data.car[z].car_model+' '+data.car[z].carfrom+' '+data.car[z].chasis+'</div>')
                    //     }
                    // }
                    $("#myTable .dnd-moved").last().append('<td style="min-width: 80px;max-width: 90px;" class="pr-0"></td>')
                    for(var y=0;y<data.engine.length;y++){
                        if(data.spare[i].id == data.engine[y].spare){
                            $("#myTable .dnd-moved td").last().append('<div id="spareEngine">'+data.engine[y].engine_l+' '+data.engine[y].engine_ide+'</div>')
                        }
                    }
                    if(data.spare[i].spare_brand){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div><div id="brand"></div></div></td>')
                    }
                    $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                    for(var m=0;m<data.category.length;m++){
                        if(data.category[m].id == data.spare[i].spare_category_id){
                            $("#myTable .dnd-moved td").last().append('<div id="categoryInfo">'+data.category[m].category+'</div>')
                        }
                    }
                    if(data.spare[i].spare_name){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div>'+data.spare[i].spare_name+'</div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;" class="pr-0"></td>')
                        if(data.atributes.length>0){
                            for(n=0;n<data.atributes.length;n++){
                                if(data.spare[i].id == data.atributes[n].atributeSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.atributes[n].atributeName.trim()+'Value"><div style="overflow:hidden" class=""><div class="row"><div id="AtrName" class="col-lg-6 col-md-6 text-end px-0">'+data.atributes[n].atributeName+':</div><div id="AtrVal" class="col-lg-6 col-md-6 text-start px-1">'+data.atributes[n].atributeVal+'</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    // Aqui van las dimensiones
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td style="max-width: 120px;display: none;" class="pr-0">')
                        if(data.dimensions.length>0){
                            for(n=0;n<data.dimensions.length;n++){
                                if(data.spare[i].id == data.dimensions[n].dimensionSpare){
                                    $("#myTable .dnd-moved td").last().append('<div class=""><div id="'+data.dimensions[n].atributeName.trim()+'Value"><div class="cantainer"><div class="row"><div id="AtrName" style="position: static;" class="col-lg-6">'+data.dimensions[n].atributeName+'</div><div id="AtrVal" style="position: static;" class="col-lg-6 ms-auto">'+data.dimensions[n].atributeVal+' mm</div></div></div></div></div>')
                                }
                            }
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_m){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_m+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(superuser=="True"){
                        if(data.spare[i].price_d){
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div>$ '+data.spare[i].price_d+'</div></td>')
                        }else{
                            $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"><div></div></td>')
                        }
                    }
                    if(data.spare[i].spare_photo){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div><div id="mainPhoto" style="background-image: url(\'/media/'+data.spare[i].spare_photo+'\');" class="photo"></div></a></div></td>')
                    }else{
                        $("#myTable .dnd-moved").last().append('<td class="pr-0"><div></div></td>')
                    }
                    if(requestVentas=="True" || superuser=="True" || requestBodega=="True"){
                        $("#myTable .dnd-moved").last().append('<td class="pr-0" style="display: none;"></td>')
                        for(var n=0;n<data.vendor.length;n++){
                            if(data.spare[i].id == data.vendor[n].spare){
                                $("#myTable .dnd-moved td").last().append('<div><div id="vendorInfo">'+data.vendor[n].vendorName+'</div></div>')
                            }
                        }
                    }
                    // if(autenticado=="True"){
                    //     $("#myTable .dnd-moved").last().append('<td class="check justify-content-center"><input class="check" type="checkbox" name="toAdd" value="'+data.spare[i].id+'"></td>')
                    // }
                }
            }


            // alert("Entra")
            // $("#myTable .bodyM").remove()
            // for(var i=0;i<data.allFacturesPay.length;i++){
            //     if(data.allFacturesPay[i].num){
            //         numero = data.allFacturesPay[i].num
            //     }else{
            //         numero = ""
            //     }
            //     fecha = new Date(data.allFacturesPay[i].fechaCreado)
            //     pos = data.allFacturesPay[i].id
            //     fecha = month[fecha.getMonth()]+" "+String(fecha.getDate()).padStart(2, "0")+", "+fecha.getFullYear()
            //     $("#myTable").prepend('<tr class="bodyM"><td class="p-2">'+numero+'</td><td class="p-2">'+data.allFacturesPay[i].refPersona__nombre+'</td><td class="p-2">'+data.allFacturesPay[i].refCategory__nombre+'</td><td class="p-2">'+data.allFacturesPay[i].note+'</td><td class="p-2">'+fecha+'</td><td class="p-2">'+data.deadlineDic[data.allFacturesPay[i].id]+' days</td><td class="p-2">$'+data.allFacturesPay[i].monto.toFixed(2)+'</td><td class="p-2">$'+data.allFacturesPay[i].iva.toFixed(2)+'</td><td class="p-2">$'+data.allFacturesPay[i].total.toFixed(2)+'</td><td class="p-2 exclude"><a style="color: white;font-size: small;" class="btn btn-secondary" href="/editeFact/'+data.allFacturesPay[i].id+'/contToPay">Editar</a> <a data-bs-toggle="modal" type="button" data-bs-target="#modalPagar'+data.allFacturesPay[i].id+'" style="font-size: small;color: aliceblue;" id="modalPagar'+data.allFacturesPay[i].id+'Id" class="btn btn-danger" href="javascript:void(0);">Pagar</a></td></tr>')
            // }
            let detailidi = $("#detail-id").index();
            let photoi = $("#photo").index();
            let codei = $("#code").index();
            let brandi = $("#brand").index();
            let typei = $("#type").index();
            let cari = $("#car").index();
            let shapei = $("#shape").index();
            let dimensionsi = $("#dimensions").index();
            let atributesi = $("#atributes").index();
            let priceDi = $("#priceD").index();
            let priceMi = $("#priceM").index();
            let referencei = $("#referenceC").index();
            let editSparei = $("#editSpare").index();
            let enginei = $("#engine").index();
            let checki = $("#check").index();
            let ecodei = $("#ecode").index();
            let categoryi = $("#category").index();
            let vendori = $("#vendor").index();

            if ($("input:checkbox[name=detail-id]:checked").val()){
                $("#detail-id").show();
                $("table td:nth-child("+(detailidi + 1)+")").show();
            }else{
                $("#detail-id").hide();
                $("table td:nth-child("+(detailidi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceM]:checked").val()){
                $("#priceM").show();
                $("table td:nth-child("+(priceMi + 1)+")").show();
            }else{
                $("#priceM").hide();
                $("table td:nth-child("+(priceMi + 1)+")").hide();
            }

            if ($("input:checkbox[name=priceD]:checked").val()){
                $("#priceD").show();
                $("table td:nth-child("+(priceDi + 1)+")").show();
            }else{
                $("#priceD").hide();
                $("table td:nth-child("+(priceDi + 1)+")").hide();
            }

            if ($("input:checkbox[name=photo]:checked").val()){
                $("#photo").show();
                $("table td:nth-child("+(photoi + 1)+")").show();
            }else{
                $("#photo").hide();
                $("table td:nth-child("+(photoi + 1)+")").hide();
            }

            if ($("input:checkbox[name=code]:checked").val()){
                $("#code").show();
                $("table td:nth-child("+(codei + 1)+")").show();
            }else{
                $("#code").hide();
                $("table td:nth-child("+(codei + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=brand]:checked").val()){
                $("#brand").show();
                $("table td:nth-child("+(brandi + 1)+")").show();
            }else{
                $("#brand").hide();
                $("table td:nth-child("+(brandi + 1)+")").hide();
            }
            
            if ($("input:checkbox[name=type]:checked").val()){
                $("#type").show();
                $("table td:nth-child("+(typei + 1)+")").show();
            }else{
                $("#type").hide();
                $("table td:nth-child("+(typei + 1)+")").hide();
            }

            if ($("input:checkbox[name=car]:checked").val()){
                $("#car").show();
                $("table td:nth-child("+(cari + 1)+")").show();
            }else{
                $("#car").hide();
                $("table td:nth-child("+(cari + 1)+")").hide();
            }

            if ($("input:checkbox[name=shape]:checked").val()){
                $("#shape").show();
                $("table td:nth-child("+(shapei + 1)+")").show();
            }else{
                $("#shape").hide();
                $("table td:nth-child("+(shapei + 1)+")").hide();
            }

            if ($("input:checkbox[name=dimensions]:checked").val()){
                $("#dimensions").show();
                $("table td:nth-child("+(dimensionsi + 1)+")").show();
            }else{
                $("#dimensions").hide();
                $("table td:nth-child("+(dimensionsi + 1)+")").hide();
            }

            if ($("input:checkbox[name=atributes]:checked").val()){
                $("#atributes").show();
                $("table td:nth-child("+(atributesi + 1)+")").show();
            }else{
                $("#atributes").hide();
                $("table td:nth-child("+(atributesi + 1)+")").hide();
            }

            if ($("input:checkbox[name=check]:checked").val()){
                $("#check").show();
                $("table td:nth-child("+(checki + 1)+")").show();
            }else{
                $("#check").hide();
                $("table td:nth-child("+(checki + 1)+")").hide();
            }

            if ($("input:checkbox[name=referenceC]:checked").val()){
                $("#referenceC").show();
                $("table td:nth-child("+(referencei + 1)+")").show();
            }else{
                $("#referenceC").hide();
                $("table td:nth-child("+(referencei + 1)+")").hide();
            }

            if ($("input:checkbox[name=editSpare]:checked").val()){
                $("#editSpare").show();
                $("table td:nth-child("+(editSparei + 1)+")").show();
            }else{
                $("#editSpare").hide();
                $("table td:nth-child("+(editSparei + 1)+")").hide();
            }

            if ($("input:checkbox[name=engine]:checked").val()){
                $("#engine").show();
                $("table td:nth-child("+(enginei + 1)+")").show();
            }else{
                $("#engine").hide();
                $("table td:nth-child("+(enginei + 1)+")").hide();
            }

            if ($("input:checkbox[name=ecode]:checked").val()){
                $("#ecode").show();
                $("table td:nth-child("+(ecodei + 1)+")").show();
            }else{
                $("#ecode").hide();
                $("table td:nth-child("+(ecodei + 1)+")").hide();
            }

            if ($("input:checkbox[name=category]:checked").val()){
                $("#category").show();
                $("table td:nth-child("+(categoryi + 1)+")").show();
            }else{
                $("#category").hide();
                $("table td:nth-child("+(categoryi + 1)+")").hide();
            }

            if ($("input:checkbox[name=vendor]:checked").val()){
                $("#vendor").show();
                $("table td:nth-child("+(vendori + 1)+")").show();
            }else{
                $("#vendor").hide();
                $("table td:nth-child("+(vendori + 1)+")").hide();
            }

            $(".pagination").empty()
            for(i=1;i<=data.numeros.length;i++){
                if(data.actual == i){
                    $(".pagination").append('<li class="page-a active"><span class="sr-only">'+i+'</span></li>')
                }else{
                    $(".pagination").append('<li class="page-a"><span class="sr-only">'+i+'</span></li>')
                }
            }
        }
    });

    // switching = true;
    // i = 0
    // while (switching){
    //     switching = false;
    //     rows = table.length;
    //     for (i = 0; i < (rows -1); i++){
    //         shouldSwitch = false;
    //         if($("#hMain th")[a].getAttribute("id")=="editSpare"){
    //             x = table[i].getElementsByTagName("td")[a].getElementsByTagName("a")[0].innerHTML.toLowerCase()
    //             y = table[i + 1].getElementsByTagName("td")[a].getElementsByTagName("a")[0].innerHTML.toLowerCase()
    //         }else{
    //             x = table[i].getElementsByTagName("td")[a].innerHTML.toLowerCase()
    //             y = table[i + 1].getElementsByTagName("td")[a].innerHTML.toLowerCase()
    //         }
    //         if (b == 'desc'){
    //             if (x > y) {
    //                 shouldSwitch = true;
    //                 break;
    //             }
    //         }else{
    //             if(x < y){
    //                 shouldSwitch = true;
    //                 break;
    //             }
    //         }
    //     }
    //     if (shouldSwitch){
    //         table[i].parentNode.insertBefore(table[i + 1], table[i]);
    //         switching = true;
    //     }
    // }
    
}


</script>

{% endblock %}


